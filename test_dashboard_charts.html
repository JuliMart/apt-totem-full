<!DOCTYPE html>
<html>
<head>
    <title>Test Dashboard Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Test Dashboard Charts</h1>
    
    <div style="width: 400px; height: 200px;">
        <canvas id="conversionsChart"></canvas>
    </div>
    
    <div style="width: 400px; height: 200px;">
        <canvas id="productsChart"></canvas>
    </div>
    
    <button onclick="testCharts()">Test Charts</button>
    
    <script>
        let conversionsChart, productsChart;
        
        function initCharts() {
            console.log('ğŸ¨ Inicializando grÃ¡ficos de prueba...');
            
            // GrÃ¡fico de conversiones por hora
            const conversionsCtx = document.getElementById('conversionsChart').getContext('2d');
            conversionsChart = new Chart(conversionsCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Conversiones',
                        data: [],
                        backgroundColor: '#667eea',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            console.log('âœ… GrÃ¡fico de conversiones inicializado:', conversionsChart);

            // GrÃ¡fico de productos mÃ¡s clickeados
            const productsCtx = document.getElementById('productsChart').getContext('2d');
            productsChart = new Chart(productsCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Clics',
                        data: [],
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#f5576c',
                            '#4facfe'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            console.log('âœ… GrÃ¡fico de productos inicializado:', productsChart);
        }
        
        function updateConversionsChart(hourlyData) {
            console.log('ğŸ“Š Actualizando grÃ¡fico de conversiones:', hourlyData);
            console.log('ğŸ“Š GrÃ¡fico de conversiones existe:', !!conversionsChart);
            
            if (!conversionsChart) {
                console.error('âŒ GrÃ¡fico de conversiones no estÃ¡ inicializado');
                return;
            }
            
            const hours = [];
            const conversions = [];
            
            // Procesar datos del formato {hour: "23:00", conversions: 16}
            hourlyData.forEach(item => {
                hours.push(item.hour);
                conversions.push(item.conversions);
            });
            
            console.log('ğŸ“Š Horas:', hours);
            console.log('ğŸ“Š Conversiones:', conversions);
            
            conversionsChart.data.labels = hours;
            conversionsChart.data.datasets[0].data = conversions;
            conversionsChart.update();
            console.log('âœ… GrÃ¡fico de conversiones actualizado');
        }
        
        function updateProductsChart(products) {
            console.log('ğŸ“ˆ Actualizando grÃ¡fico de productos:', products);
            console.log('ğŸ“ˆ GrÃ¡fico de productos existe:', !!productsChart);
            
            if (!productsChart) {
                console.error('âŒ GrÃ¡fico de productos no estÃ¡ inicializado');
                return;
            }
            
            const labels = products.slice(0, 5).map(p => p.product);
            const data = products.slice(0, 5).map(p => p.clicks);
            
            console.log('ğŸ“ˆ Labels:', labels);
            console.log('ğŸ“ˆ Data:', data);
            
            productsChart.data.labels = labels;
            productsChart.data.datasets[0].data = data;
            productsChart.update();
            console.log('âœ… GrÃ¡fico de productos actualizado');
        }
        
        async function testCharts() {
            console.log('ğŸ§ª Iniciando prueba de grÃ¡ficos...');
            
            try {
                const response = await fetch('http://127.0.0.1:8001/dashboard/metrics/live');
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“Š Datos recibidos:', data);
                    
                    if (data.hourly_conversions) {
                        console.log('âœ… Actualizando grÃ¡fico de conversiones');
                        updateConversionsChart(data.hourly_conversions);
                    } else {
                        console.log('âŒ No hay datos de hourly_conversions');
                    }
                    
                    if (data.top_products) {
                        console.log('âœ… Actualizando grÃ¡fico de productos');
                        updateProductsChart(data.top_products);
                    } else {
                        console.log('âŒ No hay datos de top_products');
                    }
                } else {
                    console.error('âŒ Error en la respuesta:', response.status);
                }
            } catch (error) {
                console.error('âŒ Error:', error);
            }
        }
        
        // Inicializar cuando se carga la pÃ¡gina
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            console.log('ğŸš€ PÃ¡gina cargada, grÃ¡ficos inicializados');
        });
    </script>
</body>
</html>

